<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>إنشاء حساب — LB4 Messenger</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
 :root{--bg:#0b0b0b;--primary:#ff7043;--muted:#cbd5e1}
 body{margin:0;font-family:'Cairo',sans-serif;background:linear-gradient(180deg,#050405,#0c0b0c);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
 .box{width:100%;max-width:520px;background:rgba(255,255,255,0.03);padding:26px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
 h2{margin:0 0 12px}
 label{display:block;text-align:right;margin:10px 0 6px;color:var(--muted)}
 input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff}
 button{margin-top:14px;background:var(--primary);border:none;padding:12px 16px;border-radius:10px;color:#071010;font-weight:800;cursor:pointer}
 .row{display:flex;gap:8px}
 .small{font-size:0.9rem;color:var(--muted);margin-top:8px}
 a.link{display:block;margin-top:12px;color:var(--muted);text-decoration:none}
</style>
</head>
<body>
  <div class="box">
    <h2>إنشاء حساب جديد</h2>
    <form id="signupForm">
      <label>الاسم المعروض</label>
      <input id="displayName" placeholder="مثال: LeoMh" required>
      <label>اسم المستخدم (username)</label>
      <input id="username" placeholder="مثال: leo123" required>
      <label>البريد الإلكتروني</label>
      <input id="email" type="email" placeholder="you@example.com" required>
      <label>كلمة المرور</label>
      <input id="password" type="password" placeholder="كلمة مرور قوية" required>
      <button type="submit">إنشاء الحساب</button>
    </form>
    <div class="small">بإنشاءك للحساب أنت توافق على شروط الاستخدام.</div>
    <a class="link" href="login.html">لديك حساب؟ تسجيل الدخول</a>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp, query, where, getDocs, collection } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCW7TGm8FQXKasKKeKXw7-f6cZzPOzhGiU",
    authDomain: "lb4-messenger.firebaseapp.com",
    projectId: "lb4-messenger",
    storageBucket: "lb4-messenger.firebasestorage.app",
    messagingSenderId: "373210384215",
    appId: "1:373210384215:web:1a23ab2832bfbacd256012",
    measurementId: "G-EQ7GH30WFQ"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  document.getElementById('signupForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const displayName = document.getElementById('displayName').value.trim();
    const username = document.getElementById('username').value.trim().toLowerCase();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    if(!displayName || !username || !email || !password) return alert('اكمل الحقول');

    // check username uniqueness
    const q = query(collection(db,'users'), where('username','==',username));
    const snap = await getDocs(q);
    if(!snap.empty) return alert('اسم المستخدم مأخوذ. اختر اسم آخر.');

    try{
      const userCred = await createUserWithEmailAndPassword(auth,email,password);
      await updateProfile(userCred.user, { displayName: displayName });
      await setDoc(doc(db,'users', userCred.user.uid), {
        uid: userCred.user.uid,
        email,
        displayName,
        username,
        createdAt: serverTimestamp(),
        friends: [],
        status: "متاح"
      });
      alert('تم إنشاء الحساب بنجاح!');
      location.href = 'home.html';
    }catch(err){
      console.error(err);
      alert('خطأ: '+ err.message);
    }
  });
</script>
</body>
</html>
